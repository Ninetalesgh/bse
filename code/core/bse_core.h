#pragma once

#define BSE_BUILD_NETWORK
#define BSE_BUILD_GRAPHICS
#define BSE_BUILD_AUDIO
#define BSE_BUILD_INPUT

#include "include/bse_file.h"
#include "include/bse_debug.h"
#include "include/bse_thread.h"
#include "include/bse_string_format.h"
#include "include/bse_color.h"
#include "include/bse_image.h"
#include "include/bse_input.h"
#include "include/bse_common.h"
#include "include/bse_unsorted_definitions.h"

namespace bse
{
  //////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////// Callback Function Definitions /////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////

  //////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////// Debug /////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////

  using debug_log_fn = void( debug::LogParameters const&, char const* message, s32 messageSize );

  //////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////// Memory ////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////

  using allocate_memory_fn = void* (s64 size);
  using free_memory_fn = void( void* );

  //////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////// File IO ///////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////

  using get_file_info_fn = bool( char const* filePath, file::Info* out_fileInfo );
  using load_file_part_fn = bool( char const* filePath, u64 readOffset, void* targetBuffer, u32 bufferSize );
  using write_file_fn = bool( char const* filePath, void const* data, u32 size, file::WriteFlags );
  using create_directory_fn = bool( char const* directoryPath );
  using get_precompiled_asset_fn = bool( char const* name, void** out_data, u64* out_size );

  //////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////// System ////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////

  using shutdown_fn = void();

  //////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////// End of Callback Function Definitions //////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////

  struct Platform
  {
    ////////// Debug /////////////////////////////////////////////////////////////////////////////////////
    debug_log_fn* debug_log;
    ////////// Memory ////////////////////////////////////////////////////////////////////////////////////
    allocate_memory_fn* allocate_memory;
    free_memory_fn* free_memory;
    ////////// File IO ///////////////////////////////////////////////////////////////////////////////////
    get_file_info_fn* get_file_info;
    load_file_part_fn* load_file_part;
    write_file_fn* write_file;
    create_directory_fn* create_directory;
    get_precompiled_asset_fn* get_precompiled_asset;
    ////////// System ////////////////////////////////////////////////////////////////////////////////////
    shutdown_fn* shutdown;


    //  bse::FileSystem* fileSystem = nullptr;
    //  bse::Font* font = nullptr;
    //  bse::GlyphTable* glyphTable = nullptr;
    // net::NetworkData network;
    //This is to be user defined
   // AppUserData* userData;

    struct ConstantInfo
    {
      char const* executablePath;
    } constant;

    struct FrameInfo
    {
      u64 frameIndex;
      float deltaTime;
      Input input;
      //float time;
    } thisFrame;

  } extern* platform;

  struct PlatformInitParams
  {
    char const* exePath;
    void* programHandle;
    Platform* platform;

    struct
    {
      s32 argumentCount;
      char** arguments;
    } commandLine;

    struct // INPUT
    {
      bool skipInitController;
    } input;

    struct // WINDOW
    {
      char const* name;
      int2 size;
      int2 position;
      bool fullscreen;
      bool skipInitWindow;
      float fpsCap;
    } window;

    struct // WORKER THREADS
    {
      s32 syncableCount;
      s32 asyncCount;
    } workerThreads;

    struct // AUDIO
    {
      bool skipInitAudio;
    } audio;

    struct // NETWORK
    {
      bool skipInitNetwork;
    } network;

    struct // CONSOLE
    {
      bool skipInitConsole;
    } console;
  };

  using core_initialize_fn = void( PlatformInitParams* );
  extern "C" core_initialize_fn core_initialize_internal;

  using core_on_reload_fn = void( Platform* );
  extern "C" core_on_reload_fn core_on_reload_internal;

  using core_tick_fn = void( Platform* );
  extern "C" core_tick_fn core_tick_internal;
};

#if defined(BSE_APP_TO_BUILD)
//include apps here?
#else
//include devenv here?
#endif

#include "bse_core_unity_build.cpp"